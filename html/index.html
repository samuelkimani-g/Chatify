<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatify - Speak Easy, Connect Freely</title>
    <link rel="stylesheet" href="/css/landingpg.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <!-- Authentication Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <div class="form-container">
                <!-- Login Form -->
                <form id="login-form">
                    <h2>Login to Chatify</h2>
                    <input type="text" id="login-username" placeholder="Username" required>
                    <input type="password" id="login-password" placeholder="Password" required>
                    <button type="submit" class="neon-button">Login</button>
                    <p>Don't have an account? <span id="show-signup" class="toggle-link">Sign Up</span></p>
                </form>

                <!-- Signup Form (Hidden by default) -->
                <form id="signup-form" style="display: none;">
                    <h2>Create Account</h2>
                    <input type="text" id="signup-username" placeholder="Username" required>
                    <input type="email" id="signup-email" placeholder="Email" required>
                    <input type="password" id="signup-password" placeholder="Password" required>
                    <button type="submit" class="neon-button">Sign Up</button>
                    <p>Already have an account? <span id="show-login" class="toggle-link">Login</span></p>
                </form>
            </div>
        </div>
    </div>

    <!-- Login Button -->
    <button id="open-login-btn" class="login-button">Login / Sign Up</button>

    <!-- Main Content -->
    <div class="landing-container">
        <video autoplay loop muted class="background-video">
            <source src="/videos/chatifyvideo.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        
        <div class="content">
            <h1>Welcome to Chatify</h1>
            <p>Speak easy, connect instantly.</p>
            <button class="start-chat" onclick="redirectToChat()">Start Chatting</button>
        </div>

        <!-- Floating Emojis -->
        <div class="emoji-float">
            <div class="emoji">üí¨</div>
            <div class="emoji">‚ú®</div>
            <div class="emoji">üöÄ</div>
            <div class="emoji">üí°</div>
            <div class="emoji">üåç</div>
        </div>
    </div>

    <script src="/js/script.js"></script>
    <script src="/js/account.js"></script>
    <script>
        // Modal Toggle
        document.getElementById('open-login-btn').addEventListener('click', () => {
            document.getElementById('auth-modal').style.display = 'flex';
        });

        // Form Switching
        document.getElementById('show-signup').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('signup-form').style.display = 'block';
        });

        document.getElementById('show-login').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('signup-form').style.display = 'none';
            document.getElementById('login-form').style.display = 'block';
        });

        // Authentication Check
        function redirectToChat() {
            if (!localStorage.getItem('chatifyUser')) {
                document.getElementById('signup-form').style.display = 'block';
                document.getElementById('auth-modal').style.display = 'flex';
            } else {
                window.location.href = '/html/chat.html';
            }
        }

        // Redirect logic for first-time users
        (async function() {
            const response = await fetch('/api/auth/check');
            if (response.ok) {
                const firstTime = localStorage.getItem('firstTime');
                if (!firstTime) {
                    localStorage.setItem('firstTime', 'true');
                    window.location.href = "/html/intro.html"; // Redirect to intro video
                } else {
                    window.location.href = "/html/chat.html"; // Redirect to chat
                }
            }
        })();
    </script>
</body>
</html>
